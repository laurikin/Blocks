(function(){define("src/tetrisConfig",{container:document.getElementById("tetris-container"),cellSize:25}),define("src/Cell",[],function(){var e=function(e){this.attrs=function(){var t=e?e:{};return{size:t.size||1,x:t.x||0,y:t.y||0}}()};return Object.defineProperties(e.prototype,{size:{get:function(){return this.attrs.size}},x:{get:function(){return this.attrs.x}},y:{get:function(){return this.attrs.y}}}),e}),define("src/Grid",["src/Cell"],function(e){var t=function(){var t=[];for(var n=this.columns-1;n>=0;n--){var r=[];t[n]=r;for(var i=this.rows-1;i>=0;i--){var s=new e({size:this.cellSize,x:n*this.cellSize,y:i*this.cellSize});this.cells.push(s),r[i]=s}}return t},n=function(e){this.attrs=function(){var t=e?e:{};return{rows:t.rows||36,columns:t.columns||12,cellSize:t.cellSize||30}}(),this.cells=[],this.matrix=t.call(this)};return n.prototype={isOutside:function(e){return e[0]>=this.columns||e[0]<0||e[1]>=this.rows||e[1]<0?!0:!1},cell:function(e,t){return this.matrix[e][t]}},Object.defineProperties(n.prototype,{rows:{get:function(){return this.attrs.rows}},columns:{get:function(){return this.attrs.columns}},cellSize:{get:function(){return this.attrs.cellSize}}}),n}),define("src/Element",[],function(){var e=function(e){this.attrs=function(){var t=e?e:{};return{color:t.color||"#f00",size:t.size||10,position:t.position||[0,0]}}()};return e.prototype={move:function(e,t){var n=this.position;n[0]+=e,n[1]+=t,this.position=n},moveDown:function(){this.move(0,1)},moveLeft:function(){this.move(-1,0)},moveRight:function(){this.move(1,0)}},Object.defineProperties(e.prototype,{color:{get:function(){return this.attrs.color},set:function(e){this.attrs.color=e}},position:{get:function(){return this.attrs.position},set:function(e){this.attrs.position=e}}}),e}),define("src/DB",{elements:[],block:0,nextBlock:0,grid:0,counter:0,deleteAll:function(){this.elements=[],this.block=0,this.nextBock=0}}),define("src/CollisionDetector",["src/DB"],function(e){var t=function(t){var n=!1;return e.elements.forEach(function(e){e.position[0]===t[0]&&e.position[1]===t[1]&&(n=!0)}),n};return{allowedToMove:function(n){return e.grid.isOutside(n)||t(n)?!1:!0}}}),define("src/Block",["src/Element","src/CollisionDetector"],function(e,t){var n=function(){var t=[];return this.schema.forEach(function(n,r){var i=new e({position:[this.schema[r][0]+this.center[0],this.schema[r][1]+this.center[1]],color:this.color});t.push(i)},this),t},r=function(){var e=[];return this.elements.forEach(function(t){var n=t.position,r=n[0]-this.center[0],i=n[1]-this.center[1],s=[i+this.center[0],-r+this.center[1]];e.push(s)},this),e},i=function(e,t){var n=[];return this.elements.forEach(function(r){var i=r.position,s=[i[0]+e,i[1]+t];n.push(s)}),n},s=function(e){var n=!1;return e.forEach(function(e){t.allowedToMove(e)||(n=!0)}),n},o=[[[-1,1],[0,1],[1,1],[0,0]],[[-1,1],[0,1],[1,1],[1,0]],[[-1,0],[0,0],[1,0],[2,0]],[[-1,0],[0,0],[-1,1],[0,1]],[[-1,0],[0,0],[0,1],[1,1]],[[-1,1],[0,1],[0,0],[1,0]],[[-1,0],[-1,1],[0,1],[1,1]]],u=["#f3bc13","#d91313","#4d9ad0","#3a4aae","#3ae03a","#e34818","#ef7c16"],a=function(e){this.attrs=function(){var t=e?e:{};return{type:typeof t.type!="undefined"?t.type:Math.floor(Math.random()*o.length),center:t.center||[4,1]}}(),this.elements=n.call(this)};return a.prototype={move:function(e,t){if(!!s(i.call(this,e,t)))return!1;this.elements.forEach(function(n){n.move(e,t)}),this.attrs.center[0]+=e,this.attrs.center[1]+=t},moveDown:function(){return this.move(0,1)},moveLeft:function(){return this.move(-1,0)},moveRight:function(){return this.move(1,0)},rotate:function(){var e=r.call(this);if(!!s.call(this,e))return!1;this.elements.forEach(function(t,n){t.position=e[n]})},collision:function(e,n){var r=i.call(this,e,n),s=!1;return r.forEach(function(e){t.allowedToMove(e)||(s=!0)}),s}},Object.defineProperties(a.prototype,{schema:{get:function(){return o[this.attrs.type]}},type:{get:function(){return this.attrs.type}},center:{get:function(){return this.attrs.center}},color:{get:function(){return u[this.attrs.type]}}}),a}),define("src/Renderer",["src/DB","src/tetrisConfig"],function(e,t){return function(){var n=[],r=function(e,n){$(e).css({width:t.cellSize-1,height:t.cellSize-1,"background-color":n.color,border:"solid 1px white","z-index":1e3,position:"absolute",top:n.position[1]*t.cellSize,left:n.position[0]*t.cellSize})},i={render:function(){var n=e.elements.concat(e.block.elements);for(var i=n.length-1;i>=0;i--)typeof n[i].node=="undefined"&&(n[i].node=function(){var e=document.createElement("div");return r(e,n[i]),$(t.container).append(e),e}()),r(n[i].node,n[i])},clear:function(){$("#tetris-container").empty(),$("#next-block").empty()},renderNextBlock:function(){var t=e.nextBlock.elements;for(var n=t.length-1;n>=0;n--)t[n].node=function(){var e=document.createElement("div");return r(e,t[n]),$("#next-block").append(e),e}()},renderGrid:function(e){for(var t=e.cells.length-1;t>=0;t--){var n=e.cells[t],r=document.createElement("div");$(r).css({width:n.size,height:n.size,"background-color":"#111",position:"absolute",border:"solid 1px #222",top:n.y,left:n.x}),$("#tetris-container").append(r)}}};return i}()}),define("src/Timer",[],function(){function e(e){this.settings=e,this.timer=null,this.running=!1,this.fps=e.fps||30,this.interval=function(){return Math.floor(1e3/this.fps)},this.timeInit=null}return e.prototype={run:function(){if(this.running){var e=this;this.settings.run(),this.timeInit+=this.interval(),this.timer=setTimeout(function(){e.run()},this.timeInit-(new Date).getTime())}},start:function(){this.timer==null&&(this.timeInit=(new Date).getTime(),this.running=!0,this.run())},stop:function(){clearTimeout(this.timer),this.timer=null,this.running=!1},increaseSpeed:function(e){this.fps=e}},e}),define("src/Destroyer",["src/DB"],function(e){var t={destroyRow:function(t){for(var n=e.elements.length-1;n>=0;n--)if(e.elements[n].position[1]===t){var r=$(e.elements[n].node);r.fadeOut(400,function(){r.remove()}),e.elements.splice(n,1),delete element}},moveRowDown:function(t){e.elements.forEach(function(e){e.position[1]<t&&e.moveDown()})},destroyableRows:function(){var t=[];for(var n=e.grid.rows-1;n>=0;n--){var r=0;e.elements.forEach(function(e){e.position[1]===n&&(r+=1)}),r>=e.grid.columns&&t.push(n)}return t},destroyRows:function(){var e=this.destroyableRows();e.forEach(function(e){this.destroyRow(e)},this);for(var t=e.length-1;t>=0;t--)this.moveRowDown(e[t]);return e}};return t}),define("src/Listeners",["src/DB"],function(e){var t=function(t){switch(t.keyCode){case 37:e.block.moveLeft(),console.log("moveLeft");break;case 38:e.block.rotate();break;case 39:e.block.moveRight();break;case 40:e.block.moveDown()}},n={createGameKeys:function(){$(document).on("keydown.game",t)},destroyGameKeys:function(){$(document).off("keydown.game")}};return n}),define("src/GameController",["src/Timer","src/DB","src/Block","src/Renderer","src/Destroyer","src/Listeners"],function(e,t,n,r,i,s){var o=function(e){if(t.block.collision(0,1)){var n=t.elements.concat(t.block.elements);return n.some(function(e){return e.position[1]===0?!0:!1})}return!1},u=function(e){return t.block.collision(0,1)?!0:!1},a=function(t){return new e({fps:2,run:t.bind(this)})},f={mainLoop:function(){var e=this;if(o())e.stop(),console.log("Game over!");else if(u()){console.log("NewBlock"),t.block.elements.forEach(function(e){t.elements.push(e)});var s=i.destroyRows();s.length>0&&e.gameTimer.increaseSpeed(Math.floor(t.counter.score/100)+2),t.counter.increment(s.length),$("#score").html(t.counter.score),t.block=new n({center:[4,0],type:t.nextBlock.type}),console.log(t.block.type),console.log(t.nextBlock.type),t.nextBlock.elements.forEach(function(e){$(e.node).remove()}),t.nextBlock=new n({center:[2,1]}),r.renderNextBlock(t.grid)}else t.block.moveDown()},gameTimer:0,prepare:function(){t.counter.restart(),$("#score").html(t.counter.score),t.deleteAll(),r.clear(),r.renderGrid(t.grid),t.block=new n({center:[4,0]}),t.nextBlock=new n({center:[2,1]}),r.renderNextBlock(),this.renderingInterval=setInterval(function(){r.render()},30),this.gameTimer=a.call(this,this.mainLoop)},start:function(){console.log("start"),this.gameTimer.start(),s.createGameKeys()},stop:function(){this.gameTimer.stop(),clearInterval(this.renderingInterval),s.destroyGameKeys(),$("#start-screen").fadeIn()}};return f}),define("src/Counter",[],function(){var e=function(){this.__score=0};return e.prototype={increment:function(e){this.__score+=Math.pow(e,2)*10},restart:function(){this.__score=0}},Object.defineProperties(e.prototype,{score:{get:function(){return this.__score}}}),e}),require.config({baseUrl:"./"}),require(["src/tetrisConfig","src/Grid","src/Block","src/DB","src/Renderer","src/GameController","src/Counter"],function(e,t,n,r,i,s,o){r.grid=new t({cellSize:e.cellSize,columns:8,rows:18});var u=r.grid;r.counter=new o,i.renderGrid(u),$(document).on("keydown.startscreen",function(e){e.keyCode===32&&$("#start-screen").css("display")!=="hidden"&&(s.prepare(),s.start(),$("#start-screen").fadeOut())})}),define("src/main",function(){})})();